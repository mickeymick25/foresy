{
  "info": {
    "name": "Foresy API - Updated",
    "description": "Collection Postman mise Ã  jour pour tester l'API Foresy en local et production.\n\n## ğŸ”§ Corrections AppliquÃ©es\n\n### âœ… ProblÃ¨me Signup RÃ©solu\n- URL locale par dÃ©faut (`{{base_url_local}}`)\n- Headers Accept ajoutÃ©s\n- Emails uniques pour Ã©viter les conflits\n- Documentation amÃ©liorÃ©e\n\n### âœ… Section CRA (FC-07) AjoutÃ©e\n- CRUD CRA complet\n- Gestion CRA Entries (nested)\n- Export CSV avec UTF-8 BOM\n- Lifecycle transitions (submit, lock)\n- Scripts de test automatiques\n\n### âœ… Configuration AmÃ©liorÃ©e\n- Switch facile entre local/production\n- Variables pour emails uniques\n- Documentation dÃ©taillÃ©e\n- Utils pour tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "{{base_url_local}}",
      "type": "string",
      "description": "URL de base - MODIFIEZ CETTE VARIABLE pour basculer entre local/production\nlocal: {{base_url_local}} | production: https://foresy-api.onrender.com"
    },
    {
      "key": "base_url_local",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "base_url_production",
      "value": "https://foresy-api.onrender.com",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "refresh_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "test_email",
      "value": "",
      "type": "string",
      "description": "Email unique pour les tests (auto-gÃ©nÃ©rÃ© via Pre-request Script)"
    },
    {
      "key": "google_client_id",
      "value": "YOUR_GOOGLE_CLIENT_ID",
      "type": "string"
    },
    {
      "key": "github_client_id",
      "value": "YOUR_GITHUB_CLIENT",
      "type": "string"
    },
    {
      "key": "oauth_code",
      "value": "",
      "type": "string"
    },
    {
      "key": "mission_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "cra_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "client_company_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Health",
      "item": [
        {
          "name": "Status API",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/",
              "host": ["{{base_url}}"],
              "path": [""]
            },
            "description": "VÃ©rifie que l'API est en ligne - Endpoint root"
          },
          "response": []
        },
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Endpoint de health check dÃ©taillÃ© avec mÃ©triques"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Signup - CORRIGÃ‰",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// GÃ©nÃ¨re un email unique pour Ã©viter les conflits",
                  "const timestamp = Date.now();",
                  "const uniqueEmail = 'test_' + timestamp + '@foresy.local';",
                  "pm.collectionVariables.set('test_email', uniqueEmail);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.token) {",
                  "        pm.collectionVariables.set('jwt_token', jsonData.token);",
                  "    }",
                  "    if (jsonData.refresh_token) {",
                  "        pm.collectionVariables.set('refresh_token', jsonData.refresh_token);",
                  "    }",
                  "    console.log('âœ… Utilisateur crÃ©Ã©:', pm.collectionVariables.get('test_email'));",
                  "} else if (pm.response.code === 422) {",
                  "    console.log('âŒ Erreur validation:', pm.response.json());",
                  "} else {",
                  "    console.log('âš ï¸ Code rÃ©ponse inattendu:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"user\": {\n    \"email\": \"{{test_email}}\",\n    \"password\": \"password123\",\n    \"password_confirmation\": \"password123\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/signup",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "signup"]
            },
            "description": "âœ… CORRIGÃ‰ - CrÃ©er un nouvel utilisateur. \n\nâœ¨ AmÃ©liorations :\n- Email unique auto-gÃ©nÃ©rÃ©\n- Headers Accept ajoutÃ©s\n- URL locale par dÃ©faut\n- Rate limiting : 3 req/min\n\nğŸ”„ CONTRACT UPDATE ADR-003 v1.4:\n- Payload maintenant : { user: { email, password, password_confirmation } }\n- Ancien format root-level REJETÃ‰ avec 400 Bad Request\n- Contract enforcement activÃ©"
          },
          "response": []
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.token) {",
                  "        pm.collectionVariables.set('jwt_token', jsonData.token);",
                  "    }",
                  "    if (jsonData.refresh_token) {",
                  "        pm.collectionVariables.set('refresh_token', jsonData.refresh_token);",
                  "    }",
                  "    console.log('âœ… Connexion rÃ©ussie');",
                  "} else {",
                  "    console.log('âŒ Ã‰chec connexion:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{test_email}}\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "login"]
            },
            "description": "Connexion utilisateur - retourne un JWT token et refresh_token\n\nRate limiting : 5 req/min"
          },
          "response": []
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.token) {",
                  "        pm.collectionVariables.set('jwt_token', jsonData.token);",
                  "    }",
                  "    if (jsonData.refresh_token) {",
                  "        pm.collectionVariables.set('refresh_token', jsonData.refresh_token);",
                  "    }",
                  "    console.log('âœ… Token rafraÃ®chi');",
                  "} else {",
                  "    console.log('âŒ Ã‰chec refresh:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refresh_token\": \"{{refresh_token}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/refresh",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "refresh"]
            },
            "description": "RafraÃ®chir le JWT token en utilisant le refresh_token\n\nRate limiting : 10 req/min"
          },
          "response": []
        },
        {
          "name": "Logout",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/auth/logout",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "logout"]
            },
            "description": "DÃ©connexion - invalide la session courante"
          },
          "response": []
        }
      ]
    },
    {
      "name": "OAuth",
      "description": "Endpoints OAuth pour Google et GitHub.\n\n## Flow OAuth:\n1. Ouvrir l'URL d'autorisation dans un navigateur\n2. Se connecter et autoriser l'application\n3. Copier le code de l'URL de redirection\n4. Utiliser le code dans la requÃªte callback\n\nâš ï¸ Les codes OAuth expirent en ~30 secondes!",
      "item": [
        {
          "name": "ğŸ“‹ Google - Get Auth URL (Copy to Browser)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "https://accounts.google.com/o/oauth2/v2/auth?client_id={{google_client_id}}&redirect_uri={{base_url}}/api/v1/auth/google_oauth2/callback&response_type=code&scope=email%20profile&prompt=select_account",
              "protocol": "https",
              "host": ["accounts", "google", "com"],
              "path": ["o", "oauth2", "v2", "auth"],
              "query": [
                { "key": "client_id", "value": "{{google_client_id}}" },
                {
                  "key": "redirect_uri",
                  "value": "{{base_url}}/api/v1/auth/google_oauth2/callback"
                },
                { "key": "response_type", "value": "code" },
                { "key": "scope", "value": "email profile" },
                { "key": "prompt", "value": "select_account" }
              ]
            },
            "description": "âš ï¸ NE PAS EXECUTER DANS POSTMAN!\n\nCopiez cette URL et ouvrez-la dans votre navigateur pour obtenir un code OAuth Google.\n\nAprÃ¨s autorisation, copiez le 'code' de l'URL de redirection."
          },
          "response": []
        },
        {
          "name": "ğŸ“‹ Google - Get Auth URL LOCAL (Copy to Browser)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "https://accounts.google.com/o/oauth2/v2/auth?client_id={{google_client_id}}&redirect_uri={{base_url_local}}/api/v1/auth/google_oauth2/callback&response_type=code&scope=email%20profile&prompt=select_account",
              "protocol": "https",
              "host": ["accounts", "google", "com"],
              "path": ["o", "oauth2", "v2", "auth"],
              "query": [
                { "key": "client_id", "value": "{{google_client_id}}" },
                {
                  "key": "redirect_uri",
                  "value": "{{base_url_local}}/api/v1/auth/google_oauth2/callback"
                },
                { "key": "response_type", "value": "code" },
                { "key": "scope", "value": "email profile" },
                { "key": "prompt", "value": "select_account" }
              ]
            },
            "description": "âš ï¸ NE PAS EXECUTER DANS POSTMAN!\n\nVersion LOCALHOST - Copiez cette URL et ouvrez-la dans votre navigateur pour obtenir un code OAuth Google.\n\nAprÃ¨s autorisation, copiez le 'code' de l'URL de redirection."
          },
          "response": []
        },
        {
          "name": "Google OAuth Callback (Production)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.token) {",
                  "        pm.collectionVariables.set('jwt_token', jsonData.token);",
                  "    }",
                  "    console.log('âœ… OAuth Google rÃ©ussi');",
                  "} else {",
                  "    console.log('âŒ Ã‰chec OAuth Google:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"{{oauth_code}}\",\n  \"redirect_uri\": \"{{base_url}}/api/v1/auth/google_oauth2/callback\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/google_oauth2/callback",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "google_oauth2", "callback"]
            },
            "description": "OAuth Google - Envoyer le code d'autorisation reÃ§u de Google.\n\nâš ï¸ Le code expire en ~30 secondes!\n\nRemplacez {{oauth_code}} par le code obtenu via l'URL d'autorisation."
          },
          "response": []
        },
        {
          "name": "Google OAuth Callback (Local)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.token) {",
                  "        pm.collectionVariables.set('jwt_token', jsonData.token);",
                  "    }",
                  "    console.log('âœ… OAuth Google LOCAL rÃ©ussi');",
                  "} else {",
                  "    console.log('âŒ Ã‰chec OAuth Google LOCAL:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"{{oauth_code}}\",\n  \"redirect_uri\": \"{{base_url_local}}/api/v1/auth/google_oauth2/callback\"\n}"
            },
            "url": {
              "raw": "{{base_url_local}}/api/v1/auth/google_oauth2/callback",
              "host": ["{{base_url_local}}"],
              "path": ["api", "v1", "auth", "google_oauth2", "callback"]
            },
            "description": "OAuth Google LOCAL - Envoyer le code d'autorisation reÃ§u de Google.\n\nâš ï¸ Le code expire en ~30 secondes!"
          },
          "response": []
        },
        {
          "name": "ğŸ“‹ GitHub - Get Auth URL (Copy to Browser)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "https://github.com/login/oauth/authorize?client_id={{github_client_id}}&redirect_uri={{base_url}}/api/v1/auth/github/callback&scope=user:email",
              "protocol": "https",
              "host": ["github", "com"],
              "path": ["login", "oauth", "authorize"],
              "query": [
                { "key": "client_id", "value": "{{github_client_id}}" },
                {
                  "key": "redirect_uri",
                  "value": "{{base_url}}/api/v1/auth/github/callback"
                },
                { "key": "scope", "value": "user:email" }
              ]
            },
            "description": "âš ï¸ NE PAS EXECUTER DANS POSTMAN!\n\nCopiez cette URL et ouvrez-la dans votre navigateur pour obtenir un code OAuth GitHub.\n\nAprÃ¨s autorisation, copiez le 'code' de l'URL de redirection."
          },
          "response": []
        },
        {
          "name": "ğŸ“‹ GitHub - Get Auth URL LOCAL (Copy to Browser)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "https://github.com/login/oauth/authorize?client_id={{github_client_id}}&redirect_uri={{base_url_local}}/api/v1/auth/github/callback&scope=user:email",
              "protocol": "https",
              "host": ["github", "com"],
              "path": ["login", "oauth", "authorize"],
              "query": [
                { "key": "client_id", "value": "{{github_client_id}}" },
                {
                  "key": "redirect_uri",
                  "value": "{{base_url_local}}/api/v1/auth/github/callback"
                },
                { "key": "scope", "value": "user:email" }
              ]
            },
            "description": "âš ï¸ NE PAS EXECUTER DANS POSTMAN!\n\nVersion LOCALHOST - Copiez cette URL et ouvrez-la dans votre navigateur pour obtenir un code OAuth GitHub.\n\nAprÃ¨s autorisation, copiez le 'code' de l'URL de redirection."
          },
          "response": []
        },
        {
          "name": "GitHub OAuth Callback (Production)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.token) {",
                  "        pm.collectionVariables.set('jwt_token', jsonData.token);",
                  "    }",
                  "    console.log('âœ… OAuth GitHub rÃ©ussi');",
                  "} else {",
                  "    console.log('âŒ Ã‰chec OAuth GitHub:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"{{oauth_code}}\",\n  \"redirect_uri\": \"{{base_url}}/api/v1/auth/github/callback\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/github/callback",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "github", "callback"]
            },
            "description": "OAuth GitHub - Envoyer le code d'autorisation reÃ§u de GitHub.\n\nâš ï¸ Le code expire rapidement!\n\nRemplacez {{oauth_code}} par le code obtenu via l'URL d'autorisation."
          },
          "response": []
        },
        {
          "name": "GitHub OAuth Callback (Local)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.token) {",
                  "        pm.collectionVariables.set('jwt_token', jsonData.token);",
                  "    }",
                  "    console.log('âœ… OAuth GitHub LOCAL rÃ©ussi');",
                  "} else {",
                  "    console.log('âŒ Ã‰chec OAuth GitHub LOCAL:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"{{oauth_code}}\",\n  \"redirect_uri\": \"{{base_url_local}}/api/v1/auth/github/callback\"\n}"
            },
            "url": {
              "raw": "{{base_url_local}}/api/v1/auth/github/callback",
              "host": ["{{base_url_local}}"],
              "path": ["api", "v1", "auth", "github", "callback"]
            },
            "description": "OAuth GitHub LOCAL - Envoyer le code d'autorisation reÃ§u de GitHub.\n\nâš ï¸ Le code expire rapidement!"
          },
          "response": []
        },
        {
          "name": "OAuth Failure",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/auth/failure",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "failure"]
            },
            "description": "Endpoint appelÃ© en cas d'Ã©chec OAuth"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Missions (FC-06)",
      "description": "Feature Contract 06 - Gestion des missions professionnelles pour indÃ©pendants\n\nâœ¨ Lifecycle : lead â†’ pending â†’ won â†’ in_progress â†’ completed\n\nğŸ—ï¸ Architecture Domain-Driven : Relations via tables dÃ©diÃ©es",
      "item": [
        {
          "name": "Create Mission (time_based)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('mission_id', jsonData.id);",
                  "    console.log('âœ… Mission time_based crÃ©Ã©e - ID:', jsonData.id);",
                  "} else {",
                  "    console.log('âŒ Erreur crÃ©ation mission:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Mission Data Platform\",\n  \"description\": \"Backend architecture and API development\",\n  \"mission_type\": \"time_based\",\n  \"status\": \"lead\",\n  \"start_date\": \"2025-01-15\",\n  \"daily_rate\": 60000,\n  \"currency\": \"EUR\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/missions",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "missions"]
            },
            "description": "âœ… NOUVELLE VERSION - CrÃ©e une mission time_based (TJM). \n\nğŸ—ï¸ Architecture DDD : Relations via tables dÃ©diÃ©es (MissionCompany)\nğŸ“Š Calculs serveur : total_days, total_amount cÃ´tÃ© serveur uniquement"
          },
          "response": []
        },
        {
          "name": "Create Mission (fixed_price)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('mission_id', jsonData.id);",
                  "    console.log('âœ… Mission fixed_price crÃ©Ã©e - ID:', jsonData.id);",
                  "} else {",
                  "    console.log('âŒ Erreur crÃ©ation mission fixed_price:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Website Redesign Project\",\n  \"description\": \"Complete website redesign with new branding\",\n  \"mission_type\": \"fixed_price\",\n  \"status\": \"lead\",\n  \"start_date\": \"2025-02-01\",\n  \"end_date\": \"2025-04-30\",\n  \"fixed_price\": 2500000,\n  \"currency\": \"EUR\",\n  \"client_company_id\": \"{{client_company_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/missions",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "missions"]
            },
            "description": "âœ… NOUVELLE VERSION - CrÃ©e une mission fixed_price (forfait) avec client company optionnel.\n\nğŸ¯ Montants en centimes : PrÃ©cision financiÃ¨re (Integer, pas de Float)"
          },
          "response": []
        },
        {
          "name": "List Missions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/missions",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "missions"]
            },
            "description": "âœ… NOUVELLE VERSION - Liste toutes les missions accessibles Ã  l'utilisateur.\n\nğŸ—ï¸ Relations : Via companies avec rÃ´le independent ou client\nğŸ“‹ Filtrage : Par statut, type, date"
          },
          "response": []
        },
        {
          "name": "Get Mission Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/missions/{{mission_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "missions", "{{mission_id}}"]
            },
            "description": "âœ… NOUVELLE VERSION - RÃ©cupÃ¨re les dÃ©tails d'une mission.\n\nğŸ—ï¸ Architecture DDD : Companies associÃ©es (independent et client)\nğŸ“Š MÃ©triques : total_days, total_amount calculÃ©s cÃ´tÃ© serveur"
          },
          "response": []
        },
        {
          "name": "Update Mission",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Mission Data Platform - Updated\",\n  \"description\": \"Updated description with new scope\",\n  \"status\": \"pending\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/missions/{{mission_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "missions", "{{mission_id}}"]
            },
            "description": "âœ… NOUVELLE VERSION - Modifie une mission.\n\nğŸ”’ ContrÃ´le d'accÃ¨s : Seul le crÃ©ateur peut modifier\nâš¡ Lifecycle : Transitions autorisÃ©es selon rÃ¨gles mÃ©tier\nğŸ“ Calculs : Mise Ã  jour automatique des mÃ©triques"
          },
          "response": []
        },
        {
          "name": "Update Mission Status (Transition)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"won\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/missions/{{mission_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "missions", "{{mission_id}}"]
            },
            "description": "âœ… NOUVELLE VERSION - Change le statut d'une mission.\n\nğŸ”„ Transitions autorisÃ©es :\n- lead â†’ pending\n- pending â†’ won  \n- won â†’ in_progress\n- in_progress â†’ completed\n\nâš ï¸ Pas de retour arriÃ¨re autorisÃ©"
          },
          "response": []
        },
        {
          "name": "Archive Mission (Soft Delete)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/missions/{{mission_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "missions", "{{mission_id}}"]
            },
            "description": "âœ… NOUVELLE VERSION - Archive une mission (soft delete).\n\nğŸ›¡ï¸ Protection : Retourne 409 Conflict si la mission est liÃ©e Ã  un CRA\nğŸ“‹ Logging : TraÃ§abilitÃ© des suppressions pour audit"
          },
          "response": []
        }
      ]
    },
    {
      "name": "CRA (FC-07) - NOUVEAU!",
      "description": "Feature Contract 07 - Gestion des Comptes Rendus d'ActivitÃ©\n\nâœ¨ **CORRIGÃ‰** - API maintenant fonctionnelle (11 Jan 2026)\n\nğŸ—ï¸ Architecture Domain-Driven avec lifecycle strict\nğŸ“Š Export CSV avec UTF-8 BOM\nğŸ”’ Git Ledger pour l'immutabilitÃ© lÃ©gale\n\nğŸ”„ **Lifecycle :** draft â†’ submitted â†’ locked (immutable)",
      "item": [
        {
          "name": "Create CRA",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('cra_id', jsonData.id);",
                  "    console.log('âœ… CRA crÃ©Ã© - ID:', jsonData.id);",
                  "    console.log('ğŸ“Š Status:', jsonData.status);",
                  "} else {",
                  "    console.log('âŒ Erreur crÃ©ation CRA:', pm.response.code, pm.response.text());",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"CRA Janvier 2026\",\n  \"description\": \"Compte rendu d'activitÃ© pour janvier\",\n  \"month\": 1,\n  \"year\": 2026,\n  \"status\": \"draft\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/cras",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras"]
            },
            "description": "âœ… **CORRIGÃ‰** - CrÃ©e un nouveau CRA (Compte Rendu d'ActivitÃ©)\n\nğŸ¯ **API Fonctionnelle** - Correction critique appliquÃ©e (11 Jan 2026)\nğŸ—ï¸ **Architecture DDD** - Relations explicites avec writers transitoires\nğŸ“Š **Calculs serveur** - total_days, total_amount cÃ´tÃ© serveur uniquement\nğŸ”’ **Soft delete** - Avec rÃ¨gles mÃ©tier (impossible si submitted/locked)"
          },
          "response": []
        },
        {
          "name": "List CRAs",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    console.log('âœ… CRAs listÃ©s:', jsonData.length);",
                  "    if (jsonData.length > 0) {",
                  "        console.log('ğŸ“Š Premier CRA:', jsonData[0].id, '- Status:', jsonData[0].status);",
                  "    }",
                  "} else {",
                  "    console.log('âŒ Erreur listage CRAs:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/cras",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras"]
            },
            "description": "âœ… **NOUVEAU** - Liste tous les CRAs de l'utilisateur\n\nğŸ” **Mini-FC-01** - Filtrage par year, month, status âœ… TERMINÃ‰\nğŸ“‹ **Pagination** - Gestion automatique (â‰¤ 10 entrÃ©es)\nğŸ—ï¸ **Architecture DDD** - Relations explicites"
          },
          "response": []
        },
        {
          "name": "Get CRA Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras", "{{cra_id}}"]
            },
            "description": "âœ… **NOUVEAU** - RÃ©cupÃ¨re les dÃ©tails d'un CRA spÃ©cifique\n\nğŸ“Š **MÃ©triques** - total_days, total_amount calculÃ©s cÃ´tÃ© serveur\nğŸ—ï¸ **Relations** - CRA Entries avec writers transitoires\nğŸ”’ **Lifecycle** - Statut et transitions disponibles"
          },
          "response": []
        },
        {
          "name": "Update CRA",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"CRA Janvier 2026 - Mis Ã  jour\",\n  \"description\": \"Description mise Ã  jour\",\n  \"status\": \"draft\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras", "{{cra_id}}"]
            },
            "description": "âœ… **NOUVEAU** - Modifie un CRA (status draft uniquement)\n\nğŸ”’ **Protection** - Impossible si status submitted ou locked\nğŸ—ï¸ **Architecture DDD** - Invariants contractuellement garantis\nâš¡ **Validation** - Lifecycle invariants respectÃ©s"
          },
          "response": []
        },
        {
          "name": "Submit CRA",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    console.log('âœ… CRA soumis - Status:', jsonData.status);",
                  "    console.log('ğŸ”’ Transition draft â†’ submitted rÃ©ussie');",
                  "} else {",
                  "    console.log('âŒ Erreur soumission CRA:', pm.response.code, pm.response.text());",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}/submit",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras", "{{cra_id}}", "submit"]
            },
            "description": "âœ… **NOUVEAU** - Soumet un CRA (draft â†’ submitted)\n\nğŸ”„ **Lifecycle** - Transition irreversible\nğŸ”’ **Protection** - ImpossibilitÃ© de modification aprÃ¨s soumission\nâš¡ **MÃ©triques** - Calculs finaux serveurs"
          },
          "response": []
        },
        {
          "name": "Lock CRA",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    console.log('âœ… CRA verrouillÃ© - Status:', jsonData.status);",
                  "    console.log('ğŸ”’ Git Ledger activÃ© pour immutabilitÃ© lÃ©gale');",
                  "} else {",
                  "    console.log('âŒ Erreur verrouillage CRA:', pm.response.code, pm.response.text());",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}/lock",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras", "{{cra_id}}", "lock"]
            },
            "description": "âœ… **NOUVEAU** - Verrouille un CRA dÃ©finitivement (submitted â†’ locked)\n\nğŸ”’ **ImmutabilitÃ©** - Versioning Git pour l'immutabilitÃ© lÃ©gale\nâš–ï¸ **LÃ©gal** - ConformitÃ© rÃ©glementaire garantie\nğŸš« **Final** - Impossible de retour arriÃ¨re"
          },
          "response": []
        },
        {
          "name": "Export CRA CSV",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('âœ… Export CSV gÃ©nÃ©rÃ©');",
                  "    console.log('ğŸ“Š Taille rÃ©ponse:', pm.response.stream?.length || 'N/A');",
                  "    console.log('ğŸ”¤ Encodage UTF-8 BOM');",
                  "} else {",
                  "    console.log('âŒ Erreur export CSV:', pm.response.code);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "text/csv"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}/export?include_entries=true",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras", "{{cra_id}}", "export"],
              "query": [
                {
                  "key": "include_entries",
                  "value": "true"
                }
              ]
            },
            "description": "âœ… **Mini-FC-02** - Export CSV avec UTF-8 BOM âœ… TERMINÃ‰\n\nğŸ“„ **Format CSV** - Export avec ou sans entries\nğŸ”¤ **UTF-8 BOM** - CompatibilitÃ© Excel parfaite\nğŸ“Š **MÃ©triques** - total_days, total_amount inclus\nâ° **Timestamp** - Fichier avec horodatage"
          },
          "response": []
        },
        {
          "name": "Delete CRA",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras", "{{cra_id}}"]
            },
            "description": "âœ… **NOUVEAU** - Supprime un CRA (soft delete)\n\nğŸ›¡ï¸ **Protection** - Impossible si status submitted ou locked\nğŸ”’ **Exceptions** - CraSubmittedError vs CraLockedError\nğŸ—ï¸ **Architecture DDD** - Relations respectÃ©es"
          },
          "response": []
        },
        {
          "name": "CRA Entries - Create Entry",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    console.log('âœ… CRA Entry crÃ©Ã©e - ID:', jsonData.id);",
                  "    console.log('ğŸ“… Date:', jsonData.date);",
                  "    console.log('â±ï¸ Hours:', jsonData.hours);",
                  "} else {",
                  "    console.log('âŒ Erreur crÃ©ation CRA Entry:', pm.response.code, pm.response.text());",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"date\": \"2026-01-15\",\n  \"hours\": 7.5,\n  \"description\": \"DÃ©veloppement API endpoints\",\n  \"mission_id\": \"{{mission_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}/entries",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras", "{{cra_id}}", "entries"]
            },
            "description": "âœ… **CORRIGÃ‰** - CrÃ©e une entrÃ©e d'activitÃ© dans un CRA\n\nğŸ¯ **API Fonctionnelle** - Correction format paramÃ¨tres appliquÃ©e\nğŸ—ï¸ **Architecture DDD** - Relations explicites (CraEntryCra)\nâš¡ **Validation** - Format dates, Hours Float, Missionå…³è”\nğŸ“Š **Calculs** - Mise Ã  jour automatique total_days/total_amount"
          },
          "response": []
        },
        {
          "name": "CRA Entries - List Entries",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}/entries",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "cras", "{{cra_id}}", "entries"]
            },
            "description": "âœ… **CORRIGÃ‰** - Liste toutes les entries d'un CRA\n\nğŸ” **Mini-FC-01** - Filtrage par year, month, status âœ… TERMINÃ‰\nğŸ“‹ **Pagination** - Gestion automatique (â‰¤ 10 entrÃ©es)\nğŸ—ï¸ **Architecture DDD** - Relations explicites avec writers transitoires"
          },
          "response": []
        },
        {
          "name": "CRA Entries - Get Entry",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}/entries/{{cra_entry_id}}",
              "host": ["{{base_url}}"],
              "path": [
                "api",
                "v1",
                "cras",
                "{{cra_id}}",
                "entries",
                "{{cra_entry_id}}"
              ]
            },
            "description": "âœ… **CORRIGÃ‰** - RÃ©cupÃ¨re les dÃ©tails d'une CRA Entry spÃ©cifique\n\nğŸ“Š **MÃ©triques** - Heures, descriptions, missions liÃ©es\nğŸ—ï¸ **Relations** - Mission association avec validation\nğŸ”’ **Lifecycle** - Protection selon CRA status"
          },
          "response": []
        },
        {
          "name": "CRA Entries - Update Entry",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"description\": \"Description mise Ã  jour\",\n  \"hours\": 8.0\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}/entries/{{cra_entry_id}}",
              "host": ["{{base_url}}"],
              "path": [
                "api",
                "v1",
                "cras",
                "{{cra_id}}",
                "entries",
                "{{cra_entry_id}}"
              ]
            },
            "description": "âœ… **CORRIGÃ‰** - Modifie une CRA Entry\n\nğŸ”’ **Protection** - Impossible si CRA submitted ou locked\nğŸ—ï¸ **Architecture DDD** - Relations respectÃ©es\nâš¡ **Recalcul** - Mise Ã  jour automatique des mÃ©triques CRA"
          },
          "response": []
        },
        {
          "name": "CRA Entries - Delete Entry",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/cras/{{cra_id}}/entries/{{cra_entry_id}}",
              "host": ["{{base_url}}"],
              "path": [
                "api",
                "v1",
                "cras",
                "{{cra_id}}",
                "entries",
                "{{cra_entry_id}}"
              ]
            },
            "description": "âœ… **CORRIGÃ‰** - Supprime une CRA Entry\n\nğŸ”’ **Protection** - Impossible si CRA submitted ou locked\nğŸ—ï¸ **Architecture DDD** - Suppression relationnelle propre\nâš¡ **Recalcul** - Mise Ã  jour automatique des mÃ©triques CRA"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Contract Tests",
      "description": "Tests de contract enforcement selon ADR-003 v1.4\n\nğŸš« **Contract Violations** - VÃ©rification que les anciens formats sont rejetÃ©s\nâœ… **Expected Behavior** - 400 Bad Request pour tous les cas de violation\nğŸ”’ **Protection** - Contract enforcement empÃªche les donnÃ©es malformÃ©es d'atteindre le domain layer",
      "item": [
        {
          "name": "Signup - Reject Root-Level Parameters",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test contract violation: paramÃ¨tres d'auth au niveau racine",
                  "pm.test('Contract violation: root-level params rejected', function () {",
                  "    pm.response.to.have.status(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.error).to.exist;",
                  "    console.log('âœ… Root-level params correctly rejected:', jsonData.error);",
                  "});",
                  "",
                  "// VÃ©rifie que c'est bien un 400 et non un 422",
                  "pm.test('Status code is 400 Bad Request', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@foresy.local\",\n  \"password\": \"password123\",\n  \"password_confirmation\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/signup",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "signup"]
            },
            "description": "ğŸš« **CONTRACT VIOLATION TEST**\n\nAncien format root-level doit Ãªtre REJETÃ‰ avec 400 Bad Request.\nContract ADR-003 v1.4: Payload doit Ãªtre { user: { email, password, password_confirmation } }"
          },
          "response": []
        },
        {
          "name": "Signup - Reject Mixed Parameters",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test contract violation: paramÃ¨tres mixtes (root + nested)",
                  "pm.test('Contract violation: mixed params rejected', function () {",
                  "    pm.response.to.have.status(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.error).to.exist;",
                  "    console.log('âœ… Mixed params correctly rejected:', jsonData.error);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@foresy.local\",\n  \"password\": \"password123\",\n  \"user\": {\n    \"email\": \"test2@foresy.local\",\n    \"password\": \"password123\",\n    \"password_confirmation\": \"password123\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/signup",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "signup"]
            },
            "description": "ğŸš« **CONTRACT VIOLATION TEST**\n\nParamÃ¨tres mixtes (root + nested) doivent Ãªtre REJETÃ‰S avec 400 Bad Request.\nCanoncial failure scenario: paramÃ¨tres dupliquÃ©s Ã  plusieurs niveaux"
          },
          "response": []
        },
        {
          "name": "Signup - Reject Missing User Key",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test contract violation: clÃ© user manquante",
                  "pm.test('Contract violation: missing user key rejected', function () {",
                  "    pm.response.to.have.status(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.error).to.exist;",
                  "    console.log('âœ… Missing user key correctly rejected:', jsonData.error);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@foresy.local\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/signup",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "signup"]
            },
            "description": "ğŸš« **CONTRACT VIOLATION TEST**\n\nPayload sans clÃ© user doit Ãªtre REJETÃ‰ avec 400 Bad Request.\nparams.require(:user) enforce la prÃ©sence de la clÃ© user"
          },
          "response": []
        },
        {
          "name": "Signup - Reject Empty User Key",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test contract violation: clÃ© user vide",
                  "pm.test('Contract violation: empty user key rejected', function () {",
                  "    pm.response.to.have.status(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.error).to.exist;",
                  "    console.log('âœ… Empty user key correctly rejected:', jsonData.error);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"user\": {}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/signup",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "signup"]
            },
            "description": "ğŸš« **CONTRACT VIOLATION TEST**\n\nClÃ© user vide doit Ãªtre REJETÃ‰E avec 400 Bad Request.\nValidates que user doit contenir les paramÃ¨tres requis"
          },
          "response": []
        },
        {
          "name": "Refresh Token - Reject Nested Parameters",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test contract violation: paramÃ¨tres refresh_token imbriquÃ©s",
                  "pm.test('Contract violation: nested refresh_token rejected', function () {",
                  "    pm.response.to.have.status(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.error).to.exist;",
                  "    console.log('âœ… Nested refresh_token correctly rejected:', jsonData.error);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"authentication\": {\n    \"refresh_token\": \"dummy_token\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/refresh",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "refresh"]
            },
            "description": "ğŸš« **CONTRACT VIOLATION TEST**\n\nRefresh token imbriquÃ© doit Ãªtre REJETÃ‰ avec 400 Bad Request.\nADR-003 v1.4: Refresh token doit Ãªtre au niveau racine { refresh_token }"
          },
          "response": []
        },
        {
          "name": "Signup - Accept Valid Contract (Positive Test)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// GÃ©nÃ¨re un email unique pour le test positif",
                  "const timestamp = Date.now();",
                  "const uniqueEmail = 'contract_test_' + timestamp + '@foresy.local';",
                  "pm.collectionVariables.set('contract_test_email', uniqueEmail);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test acceptance: format contract valide",
                  "pm.test('Valid contract accepted', function () {",
                  "    pm.response.to.have.status(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.token).to.exist;",
                  "    console.log('âœ… Valid contract correctly accepted:', jsonData.token ? 'JWT received' : 'No JWT');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"user\": {\n    \"email\": \"{{contract_test_email}}\",\n    \"password\": \"password123\",\n    \"password_confirmation\": \"password123\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/signup",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "signup"]
            },
            "description": "âœ… **POSITIVE TEST**\n\nFormat contract valide ADR-003 v1.4 doit Ãªtre ACCEPTÃ‰ avec 201 Created.\nConfirme que le nouveau format fonctionne correctement"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Utils - Tests",
      "description": "Utilitaires pour faciliter les tests et le debugging\n\nğŸ§¹ **Nettoyage** - Suppression des donnÃ©es de test\nğŸ”„ **Reset** - Remise Ã  zÃ©ro des variables\nğŸ“Š **Debug** - Informations de debugging",
      "item": [
        {
          "name": "Reset All Variables",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Reset toutes les variables de la collection",
                  "pm.collectionVariables.clear();",
                  "console.log('âœ… Variables remises Ã  zÃ©ro');",
                  "",
                  "// RÃ©initialiser les variables essentielles",
                  "pm.collectionVariables.set('base_url_local', 'http://localhost:3000');",
                  "pm.collectionVariables.set('base_url_production', 'https://foresy-api.onrender.com');",
                  "pm.collectionVariables.set('base_url', '{{base_url_local}}');",
                  "",
                  "console.log('ğŸ”„ Base URL dÃ©finie sur local:', pm.collectionVariables.get('base_url'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "about:blank",
              "host": ["about"],
              "path": ["blank"]
            },
            "description": "ğŸ§¹ **NETTOYAGE** - Remet Ã  zÃ©ro toutes les variables de la collection\n\nâš ï¸ **Attention** : Ceci efface tous les tokens et IDs stockÃ©s\nâœ… **Usage** : Avant de commencer une nouvelle session de tests"
          },
          "response": []
        },
        {
          "name": "Switch to Local Environment",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.collectionVariables.set('base_url', '{{base_url_local}}');",
                  "console.log('âœ… BasculÃ© vers environnement LOCAL');",
                  "console.log('ğŸŒ URL:', pm.collectionVariables.get('base_url'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "about:blank",
              "host": ["about"],
              "path": ["blank"]
            },
            "description": "ğŸŒ **ENVIRONNEMENT** - Bascule vers l'URL locale\n\nğŸ“ **URL** : http://localhost:3000\nğŸš€ **Usage** : Tests en dÃ©veloppement local"
          },
          "response": []
        },
        {
          "name": "Switch to Production Environment",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.collectionVariables.set('base_url', '{{base_url_production}}');",
                  "console.log('âœ… BasculÃ© vers environnement PRODUCTION');",
                  "console.log('ğŸŒ URL:', pm.collectionVariables.get('base_url'));",
                  "console.log('âš ï¸ Attention : Tests sur environnement de production!');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "about:blank",
              "host": ["about"],
              "path": ["blank"]
            },
            "description": "ğŸš€ **ENVIRONNEMENT** - Bascule vers la production\n\nğŸ“ **URL** : https://foresy-api.onrender.com\nâš ï¸ **Attention** : Tests sur environnement de production!"
          },
          "response": []
        },
        {
          "name": "Debug - Show Current Variables",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Affiche toutes les variables actuelles",
                  "console.log('ğŸ“Š === VARIABLES ACTUELLES ===');",
                  "pm.collectionVariables.all().forEach(variable => {",
                  "    console.log(`${variable.key}: ${variable.value}`);",
                  "});",
                  "console.log('ğŸ“Š =============================');",
                  "",
                  "// Affiche des infos sur l'environnement",
                  "console.log('ğŸŒ Base URL:', pm.collectionVariables.get('base_url'));",
                  "console.log('ğŸ”‘ JWT Token prÃ©sent:', !!pm.collectionVariables.get('jwt_token'));",
                  "console.log('ğŸ”„ Refresh Token prÃ©sent:', !!pm.collectionVariables.get('refresh_token'));",
                  "console.log('ğŸ¯ Mission ID:', pm.collectionVariables.get('mission_id') || 'Non dÃ©fini');",
                  "console.log('ğŸ“‹ CRA ID:', pm.collectionVariables.get('cra_id') || 'Non dÃ©fini');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "about:blank",
              "host": ["about"],
              "path": ["blank"]
            },
            "description": "ğŸ› **DEBUG** - Affiche toutes les variables actuelles de la collection\n\nğŸ“Š **Infos** : URLs, tokens, IDs\nğŸ” **Usage** : Diagnostic en cas de problÃ¨me\nğŸ’¡ **Conseil** : Ã€ exÃ©cuter avant les tests"
          },
          "response": []
        },
        {
          "name": "Test Connection",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "ğŸ”— **CONNEXION** - Test de connexion Ã  l'API actuelle\n\nğŸŒ **URL** : {{base_url}}/health\nâœ… **VÃ©rifie** : API accessible et healthy\nâš¡ **Rapide** : Diagnostic en 1 requÃªte"
          },
          "response": []
        }
      ]
    }
  ]
}
